webpackJsonp([34],{AUhH:function(e,t){},mbRy:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=a("bOdI"),i=a.n(o),r=a("TVG1"),n={name:"allService",components:{UploadImg:a("V66y").a},data:function(){var e=this;return{loading:!0,disabled:!1,label:"",secondList:[],qiniuToken:{key:"",token:""},editorId:"",serverType:[],eidtImg:[],domain:"",belongList:[],pageConfig:{current:1,size:10,bigSize:100,totalCount:0},showType:"",urlShow:!1,btnShow:!1,modalShow:!1,btnFlag:!1,poseObj:{},serverOptionList:[],btnTitle:"",addAllForm:{belong:"",name:"",serverOption:"",imgKey:"",second:"",needLogin:"Y"},addAllRules:{belong:[{required:!0,message:"请选择所属栏目",trigger:"blur"}],url:[{required:!0,message:"请输入内转链接",trigger:"blur"}],name:[{required:!0,message:"请填写名称显示",trigger:"blur"}]},title:"新增服务",addAllServe:!1,AdTypeList:[],columns:[{title:"编号",key:"",render:function(e,t){return e("span",t.index+1)}},{title:"服务名称",key:"title"},{title:"图片",key:"iconName",render:function(e,t){return e("img",{attrs:{src:"//"+t.row.iconUrl},style:{height:"40px",width:"40px"}})}},{title:"类型",key:"serviceCategoryName"},{title:"位置",key:"",render:function(e,t){return e("span","首页")}},{title:"发布日期",key:"createTime",sortable:!0},{title:"点击量",key:"clickCount",sortable:!0},{title:"操作",key:"",render:function(t,a){return t("div",[t("Button",{props:{type:"primary",size:"small"},style:{marginRight:"10px"},on:{click:function(){e.editorId=a.row.serviceId,e.idEditor(a.row.serviceId),e.addAllServe=!0,e.title="编辑服务"}}},"编辑"),t("Button",{props:{type:"error",size:"small"},on:{click:function(){var t=e;t.$store.commit("setDeleteModal",{model:!0,callback:function(){t.delThis(a.row.serviceId)}})}}},"删除")])}}],lists:[]}},methods:{secondOnServe:function(e){},openChange:function(e){if(1==e){this.serveListRemote("")}},changeQuery:function(e){""==e&&this.serveListRemote(e)},sortChange:function(e){var t=void 0;t="desc"==e.order?"down":"up","createTime"==e.key?this.getCol(t,"createTime"):this.getCol(t,"clickCount")},dragRow:function(e,t){var a=r.a.sortTableRow(e,t,this.lists);this.lists=a},getServerItem:function(e){var t=this,a={categoryId:e};this.$http.get("/yyht/v1/repair/category/select/next",{params:a}).then(function(e){0==e.data.code?t.secondList=e.data.data:t.$Message.warning(e.data.msg)})},delThis:function(e){var t=this;this.$http.get("/yyht/v1/service/delete?id="+e).then(function(e){0==e.data.code?(t.$Message.success("删除成功"),t.$store.commit("setDeleteModal",{model:!1}),t.getCol()):t.$Message.warning(e.data.msg)})},changeServer:function(e){var t=this;console.log(e),this.getServerItem(e),this.serverOptionList.forEach(function(a,o){a.serviceId==e&&("APP_JUMP"==t.poseObj.code?(t.addAllForm.target=a.target,t.addAllForm.needLogin=a.needLogin,t.disabled=!0):t.addAllForm.serverOption=a.serviceId)})},idEditor:function(e){var t=this;this.$http.get("/yyht/v1/service/getServiceInfoById?id="+e).then(function(e){if(0==e.data.code){var a=e.data.data;if(t.addAllForm.belong=a.idServiceType,t.addAllForm.name=a.title,t.addAllForm.needLogin=a.needLogin,t.poseObj.id=a.idServiceCategory,t.poseObj.code=a.serviceCategoryCode,t.poseObj.name=a.serviceCategoryName,t.showType=a.serviceCategoryName,"APP_JUMP"==a.serviceCategoryCode?t.disabled=!0:t.disabled=!1,t.serverType.forEach(function(e,o){a.serviceCategoryCode==e.code&&(t.serverType[o].color="#d5e8fc")}),"H5"==a.serviceCategoryCode)t.urlShow=!0,t.btnShow=!0,t.addAllForm.url=a.target;else switch(t.btnShow=!0,t.btnFlag=!0,a.parentName?t.btnTitle=a.parentName+"-"+a.targetName:t.btnTitle=a.targetName,a.serviceCategoryCode){case"APP_JUMP":t.addAllForm.target=a.target;break;case"E_SERVICE_CATEGORY":t.addAllForm.serverOption=a.target;break;default:t.addAllForm.second=a.target}a.imageUrl&&(t.eidtImg=[{name:"图标",url:"//"+a.iconUrl,status:"finished"}],t.addAllForm.imgKey=a.imgKey)}else t.$Message.warning(e.data.msg)})},okModal:function(){var e=this,t=void 0;this.serverOptionList.forEach(function(a){a.serviceId==e.addAllForm.serverOption&&(t=a.title)}),this.addAllForm.second?this.secondList.forEach(function(a){a.id==e.addAllForm.second&&(e.btnTitle=t+"-"+a.name)}):this.btnTitle=t,this.btnFlag=!0,this.modalShow=!1},serveListRemote:function(e){var t=this,a=e;this.$http.get("/yyht/v1/service/getServiceByCategoryByCode?code="+this.poseObj.code+"&name="+a).then(function(e){0==e.data.code?t.serverOptionList=e.data.data:t.$Message.warning(e.data.msg)})},getOptionType:function(){var e=this;this.$http.get("/yyht/v1/service/getServiceByCategoryByCode?code="+this.poseObj.code+"&name=").then(function(t){0==t.data.code?(e.serverOptionList=t.data.data,e.label="E_PROJECT"==e.poseObj.code?"请选择服务项目类型:":"请选择"+e.poseObj.name+":",e.modalShow=!0):e.$Message.warning(t.data.msg)})},typeFn:function(e,t){if(this.addAllForm.needLogin="Y",this.disabled=!1,this.addAllForm.serverOption="",this.addAllForm.second="",this.serverType.forEach(function(e,a){e.color=a==t?"#d5e8fc":"white"}),e.id)switch(this.poseObj.code=e.code,this.poseObj.id=e.id,this.poseObj.name=e.name,this.btnShow=!0,this.btnFlag=!1,5==e.id?this.urlShow=!0:this.urlShow=!1,e.id){case"3":this.showType="APP内转";break;case"14":this.showType="服务分类";break;default:this.showType="服务项目"}else this.btnShow=!1},addCategory:function(){var e=this;this.$http.get("/yyht/v1/service/category/getAllServiceCategory").then(function(t){0==t.data.code?(t.data.data.forEach(function(e,t){e.color="white"}),e.serverType=t.data.data):e.$Message.warning(t.data.msg)})},addModalChange:function(e){0==e?(this.title="新增服务",this.eidtImg=[],this.urlShow=!1,this.btnShow=!1,this.serverType.forEach(function(e){delete e.color}),this.$refs.addAllServeRefs.resetFields(),this.addAllForm={belong:"",name:"",serverOption:"",imgKey:"",needLogin:"Y"},this.disabled=!1):1==this.belongList.length?this.addAllForm.belong=this.belongList[0].id:this.addAllForm.belong=""},uploadCallback:function(e){this.$set(this.addAllForm,"imgKey",e.key)},changeSize:function(e){this.pageConfig.size=e,this.getCol()},changeCurrent:function(e){this.pageConfig.current=e,this.getCol()},getCol:function(e,t){var a=this;this.loading=!0,e||(e=""),t||(t=""),this.$http.get("/yyht/v1/service/getAllServiceByServiceTyIdForPage?PageSize="+this.pageConfig.size+"&pageNo="+this.pageConfig.current+"&id="+this.defaultServeId+"&flag="+e+"&type="+t).then(function(e){0==e.data.code?(a.lists=e.data.data.list,a.loading=!1,a.pageConfig.totalCount=e.data.data.totalCount):a.$Message.warning(e.data.msg)})},getServeCol:function(){var e=this;this.$http.get("/yyht/v1/service/type/getAllServiceType").then(function(t){0==t.data.code?(e.belongList=t.data.data,e.defaultServeId=t.data.data[0].id,e.defaultName=t.data.data[0].typeName,e.getCol(),e.AdTypeList=t.data.data):e.$Message.warning(t.data.msg)})},saveAddAll:function(e){var t=this;this.$refs[e].validate(function(e){if(e){var a;if(!t.poseObj.id)return void t.$Message.warning("请选择服务分类!");if(!(t.addAllForm.serverOption||t.addAllForm.url||t.addAllForm.second||t.addAllForm.target))return void t.$Message.warning("请选择"+t.poseObj.name);if(!t.addAllForm.imgKey)return void t.$Message.warning("请上传图标设置!");if("E_PROJECT"==t.poseObj.code&&!t.addAllForm.second)return void t.$Message.warning("请选择服务分类下的服务项目!");if(!t.addAllForm.needLogin)return void t.$Message.warning("请选择是否登录APP!");var o=void 0;switch(t.poseObj.code){case"H5":o=t.addAllForm.url;break;case"APP_JUMP":o=t.addAllForm.target;break;case"E_SERVICE_CATEGORY":o=t.addAllForm.serverOption;break;default:o=t.addAllForm.second}var r=(a={id:t.editorId,idServiceCategory:t.poseObj.id,idServiceType:t.addAllForm.belong,imageUrl:t.addAllForm.imgKey,needLogin:"N",serviceCategoryCode:t.poseObj.code},i()(a,"needLogin",t.addAllForm.needLogin),i()(a,"target",o),i()(a,"title",t.addAllForm.name),a);t.editorId||delete r.id,t.$http.post("/yyht/v1/service/addOrUpdate",r).then(function(e){0==e.data.code?(t.addAllServe=!1,t.getCol(),t.editorId=""):t.$Message.warning(e.data.msg)})}})},cancel:function(){this.addAllServe=!1},tabChange:function(e){var t=this;this.AdTypeList.forEach(function(a,o){e==o&&(t.defaultServeId=a.id,t.defaultName=a.typeName,t.getCol())})}},mounted:function(){this.getServeCol(),this.addCategory()}},l={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("Card",[a("div",{staticClass:"clearfix mb-15"},[a("div",{staticClass:"pull-right"},[a("Button",{attrs:{icon:"md-add",type:"primary"},on:{click:function(t){e.addAllServe=!0}}},[e._v("新增服务")])],1)]),e._v(" "),a("Tabs",{attrs:{type:"card"},on:{"on-click":e.tabChange}},e._l(e.AdTypeList,function(t,o){return a("TabPane",{key:o,attrs:{label:t.typeName}},[a("Table",{attrs:{columns:e.columns,data:e.lists,draggable:"",loading:e.loading},on:{"on-drag-drop":e.dragRow,"on-sort-change":e.sortChange}})],1)})),e._v(" "),a("div",{staticClass:"pagination mt-15"},[a("Page",{attrs:{current:e.pageConfig.current,"page-size":e.pageConfig.size,total:e.pageConfig.totalCount,"show-elevator":"","show-sizer":""},on:{"update:current":function(t){e.$set(e.pageConfig,"current",t)},"on-change":e.changeCurrent,"on-page-size-change":e.changeSize}})],1)],1),e._v(" "),a("Modal",{attrs:{title:e.title,"mask-closable":!1,closable:!1},on:{"on-visible-change":e.addModalChange},model:{value:e.addAllServe,callback:function(t){e.addAllServe=t},expression:"addAllServe"}},[a("Form",{ref:"addAllServeRefs",attrs:{"label-width":100,rules:e.addAllRules,model:e.addAllForm}},[a("FormItem",{attrs:{prop:"belong",label:"所属栏目:"}},[a("Select",{model:{value:e.addAllForm.belong,callback:function(t){e.$set(e.addAllForm,"belong",t)},expression:"addAllForm.belong"}},e._l(e.belongList,function(t){return a("Option",{key:t.id,attrs:{value:t.id}},[e._v(e._s(t.typeName))])}))],1),e._v(" "),a("div",{staticClass:"labelBefore"},[a("FormItem",{attrs:{label:"类型:"}},[a("div",{staticClass:"typeChoose"},e._l(e.serverType,function(t,o){return a("Button",{key:t.code,style:{background:t.color},attrs:{type:"default"},on:{click:function(a){e.typeFn(t,o)}}},[e._v(e._s(t.name))])}))])],1),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:1==e.btnShow,expression:"btnShow == true"}]},[a("div",{staticClass:"labelBefore"},[1==e.urlShow?a("FormItem",{attrs:{label:"URL:",prop:"url"}},[a("Input",{model:{value:e.addAllForm.url,callback:function(t){e.$set(e.addAllForm,"url",t)},expression:"addAllForm.url"}})],1):a("FormItem",{attrs:{label:""}},[1==e.btnFlag?a("Button",{attrs:{type:"primary"},on:{click:e.getOptionType}},[e._v(e._s(e.btnTitle))]):a("Button",{attrs:{type:"primary"},on:{click:e.getOptionType}},[e._v("选择"+e._s(e.showType))])],1)],1)]),e._v(" "),a("div",{staticClass:"labelBefore"},[a("FormItem",{attrs:{prop:"needLogin",label:"是否登录APP:"}},[a("RadioGroup",{model:{value:e.addAllForm.needLogin,callback:function(t){e.$set(e.addAllForm,"needLogin",t)},expression:"addAllForm.needLogin"}},[a("Radio",{attrs:{label:"Y",disabled:e.disabled}},[e._v("是")]),e._v(" "),a("Radio",{attrs:{label:"N",disabled:e.disabled}},[e._v("否")])],1)],1)],1),e._v(" "),a("FormItem",{attrs:{prop:"name",label:"名称显示:"}},[a("Input",{attrs:{maxlength:5},model:{value:e.addAllForm.name,callback:function(t){e.$set(e.addAllForm,"name",t)},expression:"addAllForm.name"}}),a("span",[e._v("App分类显示最多5个字")])],1),e._v(" "),a("div",{staticClass:"labelBefore"},[a("FormItem",{attrs:{label:"图标设置:"}},[a("UploadImg",{ref:"upImg",attrs:{qiniuToken:e.qiniuToken,multiple:!1,eidtImg:e.eidtImg},on:{uploadCallback:e.uploadCallback}})],1)],1)],1),e._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{on:{click:e.cancel}},[e._v("取消")]),e._v(" "),a("Button",{attrs:{type:"primary"},on:{click:function(t){e.saveAddAll("addAllServeRefs")}}},[e._v("确认")])],1)],1),e._v(" "),a("Modal",{attrs:{title:e.showType},on:{"on-ok":e.okModal,"on-cancel":function(t){e.modalShow=!1}},model:{value:e.modalShow,callback:function(t){e.modalShow=t},expression:"modalShow"}},[a("Form",{attrs:{model:e.addAllForm,"label-width":130}},[a("FormItem",{attrs:{label:e.label}},[a("Select",{attrs:{remote:!0,"remote-method":e.serveListRemote,filterable:!0,loading:!1},on:{"on-query-change":e.changeQuery,"on-change":e.changeServer,"on-open-change":e.openChange},model:{value:e.addAllForm.serverOption,callback:function(t){e.$set(e.addAllForm,"serverOption",t)},expression:"addAllForm.serverOption"}},e._l(e.serverOptionList,function(t,o){return a("Option",{key:o,attrs:{value:t.serviceId}},[e._v(e._s(t.title))])}))],1),e._v(" "),a("FormItem",{directives:[{name:"show",rawName:"v-show",value:"E_PROJECT"==e.poseObj.code,expression:"poseObj.code == 'E_PROJECT'"}],attrs:{label:"请选择服务项目:"}},[a("Select",{on:{"on-change":e.secondOnServe},model:{value:e.addAllForm.second,callback:function(t){e.$set(e.addAllForm,"second",t)},expression:"addAllForm.second"}},e._l(e.secondList,function(t,o){return a("Option",{key:o,attrs:{value:t.id}},[e._v(e._s(t.name))])}))],1),e._v(" "),a("FormItem",{attrs:{label:""}},[a("div",{staticStyle:{color:"#CD0000"}},[a("p",[e._v("*请输入搜索或点击选择")]),a("p",{directives:[{name:"show",rawName:"v-show",value:"E_PROJECT"==e.poseObj.code,expression:"poseObj.code == 'E_PROJECT'"}]},[e._v("*请先选择服务类型再选择服务项目")])])])],1)],1)],1)},staticRenderFns:[]};var d=a("VU/8")(n,l,!1,function(e){a("AUhH")},null,null);t.default=d.exports}});