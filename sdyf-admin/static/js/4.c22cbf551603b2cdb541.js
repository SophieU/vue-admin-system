webpackJsonp([4],{h59p:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o={name:"role-control",data:function(){return{loadingSend:!1,type:1,id:"",viewInfo:!1,roleInfo:{name:"",description:"",menuIds:"",id:"",callCenterId:""},authLists:[],authListsCheck:[],roleInfoRule:{name:[{required:!0,message:"请输入角色名称",trigger:"blur"}],description:[{required:!0,message:"请输入角色描述",trigger:"blur"}]}}},methods:{checkNodes:function(t){this.authListsCheck=t.map(function(t){return t.id})},goback:function(){this.$router.back()},getRoleInfo:function(t){var e=this;this.$http.get("/sys/v1/role/info?id="+t).then(function(t){0===t.data.code?(e.roleInfo=t.data.data,e.authListsCheck=t.data.data.menuIds,e.getAuth()):console.log(t.data.msg)})},saveThis:function(){var t=this;this.loadingSend=!0;var e,n=this.roleInfo;e="/sys/v1/role/defend",this.$refs.roleInfo.validate(function(o){o?t.$http.post(e,{name:n.name,description:n.description,menuIds:t.authListsCheck,id:n.id}).then(function(e){0===e.data.code?(t.$Message.success("保存成功"),t.$router.push({name:"role"})):t.$Message.error(e.data.msg),t.loadingSend=!1}):t.loadingSend=!1})},getAuth:function(){var t=this;this.$http.get("/sys/v1/role/findAllMenu").then(function(e){if(0===e.data.code){var n=e.data.data,o=t.authListsCheck,i={},a=t;i=o.length>0?t.iteratorTree(n,function(t){t.title=t.title,t.expand=!0,t.disabled=a.viewInfo,o.forEach(function(e){t.id===e&&(t.checked=!0)})}):t.iteratorTree(n,function(t){t.title=t.title,t.expand=!0,t.disabled=a.viewInfo}),t.authLists=i}else console.log(e.data.msg)})},iteratorTree:function(t,e){var n=this,o=[],i=this;return t instanceof Array&&(o=t.map(function(t){return"function"==typeof e&&e(t),t.disabled=i.viewInfo,t.children&&t.children.length>0&&n.iteratorTree(t.children,e),t})),o}},mounted:function(){this.type=this.$route.query.type,this.id=this.$route.query.id,1*this.type==0?this.getRoleInfo(this.id):1*this.type==2?(this.viewInfo=!0,this.getRoleInfo(this.id)):this.getAuth()},watch:{viewInfo:function(t){this.getAuth()}}},i={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"role-setting"},[n("Card",{staticStyle:{"padding-bottom":"30px"}},[n("div",{staticClass:"clearfix mb-15"},[n("div",{staticClass:"pull-left"},[n("Button",{attrs:{type:"primary"},on:{click:function(e){t.goback()}}},[t._v("返回上一页")])],1),t._v(" "),n("div",{staticClass:"pull-right"},[t.viewInfo?t._e():n("Button",{on:{click:t.goback}},[t._v("取消")]),t._v(" "),t.viewInfo?n("Button",{attrs:{type:"primary"},on:{click:function(e){t.viewInfo=!1}}},[t._v("编辑")]):t._e(),t._v(" "),t.viewInfo?t._e():n("Button",{attrs:{loading:t.loadingSend,type:"primary"},on:{click:t.saveThis}},[t._v("保存")])],1)]),t._v(" "),n("div",{staticClass:"role-panel"},[n("Form",{ref:"roleInfo",attrs:{model:t.roleInfo,"label-position":"top",rules:t.roleInfoRule}},[n("Row",{attrs:{gutter:40}},[n("Col",{attrs:{span:"12"}},[n("h4",[t._v("基础信息")]),t._v(" "),n("FormItem",{attrs:{label:"角色名称",prop:"name"}},[n("Input",{attrs:{disabled:t.viewInfo},model:{value:t.roleInfo.name,callback:function(e){t.$set(t.roleInfo,"name",e)},expression:"roleInfo.name"}})],1),t._v(" "),n("FormItem",{attrs:{label:"角色描述",prop:"description"}},[n("Input",{attrs:{maxlength:150,placeholder:"最多150字",disabled:t.viewInfo,type:"textarea",rows:10},model:{value:t.roleInfo.description,callback:function(e){t.$set(t.roleInfo,"description",e)},expression:"roleInfo.description"}})],1)],1),t._v(" "),n("Col",{attrs:{span:"12"}},[n("h4",[t._v("功能权限")]),t._v(" "),n("Tree",{ref:"authTree",staticClass:"role-tree",attrs:{data:t.authLists,"show-checkbox":"",multiple:""},on:{"on-check-change":t.checkNodes}})],1)],1)],1)],1)])],1)},staticRenderFns:[]};var a=n("VU/8")(o,i,!1,function(t){n("t6o6")},"data-v-4334f4b2",null);e.default=a.exports},t6o6:function(t,e){}});