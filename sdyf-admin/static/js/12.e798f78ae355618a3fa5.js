webpackJsonp([12],{"2btl":function(e,t){},"2nae":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r("Dd8w"),i=r.n(o),s=r("M4fF"),a=r.n(s),n={name:"input-number",props:["value"],data:function(){return{keyValid:!1}},methods:{validateKey:function(e){var t=e.key,r=this.value?this.value.toString():"";if(/(\d|\.)/.test(t)){var o=r.split(".");o.length>=2&&o[1].length>=2&&event.preventDefault()}"."===t&&r.indexOf(".")>-1&&event.preventDefault()},validateInput:function(e){var t=e.target.value;t=t.length<=0?null:parseFloat(t),this.$emit("input",t)}}},d={render:function(){var e=this.$createElement;return(this._self._c||e)("input",{staticStyle:{"ime-mode":"disabled"},attrs:{type:"number",onpaste:"return false",ondragenter:"return false",oncontextmenu:"return false;",autocomplete:!1},domProps:{value:this.value},on:{keydown:this.validateKey,input:this.validateInput}})},staticRenderFns:[]};var c=r("VU/8")(n,d,!1,function(e){r("qAFU")},"data-v-5c188365",null).exports,l=r("TVG1"),m=r("h2kg"),p=r("sYY+"),u=r.n(p),v={name:"service-project",components:{InputNumber:c},computed:{uploadUrl:function(){return m.a.defaults.baseURL+"/repair/category/import"},uploadData:function(){return{parentId:this.currentNode.id}}},data:function(){return{editTypeForm:!1,editProForm:!1,currentNodeType:"",editTypeFormType:"add",editProFormType:"add",typeLists:[],typeForm:{id:"",name:"",sortIndex:null,isShow:"Y"},proForm:{id:"",name:"",parentId:"",isUserCanUse:"",isServiceUserCanUse:"",hasDtdServiceFee:"",dtdServiceFee:"",isPrepayDtd:"",employeeDtdServiceCommission:"",isShow:""},treeLists:[],iconLists:[],currentNode:{},typeRule:{name:[{required:!0,message:"请填写服务项目类型名称",trigger:"blur"}],sortIndex:[{required:!0,type:"number",message:"请填写服务项目类型排序",trigger:"change"}],isShow:[{required:!0,message:"请选择服务项目类型显示状态",trigger:"change"}]}}},methods:{getRepireIcon:function(){var e=this;this.$http.get("/repair/category/icon/list").then(function(t){0===t.data.code&&(e.iconLists=t.data.data)})},getTypeList:function(){var e=this;this.$http.get("/yyht/v1/repair/category/select/first").then(function(t){0===t.data.code&&(e.typeLists=t.data.data)})},initialForm:function(){this.typeForm={name:"",sortIndex:null,isShow:"Y",id:""},this.proForm={id:"",name:"",parentId:"",isUserCanUse:"",isServiceUserCanUse:"",hasDtdServiceFee:"",dtdServiceFee:"",isPrepayDtd:"",employeeDtdServiceCommission:"",isShow:""},this.editTypeForm=!1,this.editProForm=!1},addNodeAPI:function(e){var t=this;this.$http.post("/yyht/v1/repair/category/addOrUpdate",i()({},e)).then(function(e){0===e.data.code?(t.$Message.success("保存成功"),t.initialForm(),t.getTreeLists()):t.$Message.error(e.data.msg)})},editNodeAPI:function(e){var t=this;this.$http.post("/yyht/v1/repair/category/addOrUpdate",i()({},e)).then(function(e){0===e.data.code?(t.$Message.success("保存成功"),t.initialForm(),t.getTreeLists()):t.$Message.error(e.data.msg)})},editNode:function(){this.currentNodeType?"first"===this.currentNodeType?(this.editTypeForm=!0,this.editTypeFormType="edit"):(this.editProForm=!0,this.editProFormType="edit"):this.$Message.info("请先选择项目节点")},saveTypeForm:function(){var e=this,t=this.typeForm,r={name:t.name,sortIndex:t.sortIndex,isShow:t.isShow,id:t.id};this.$refs.typeForm.validate(function(t){t&&("add"===e.editTypeFormType?e.addNodeAPI(r):e.editNodeAPI(r))})},saveProForm:function(){var e=this.proForm,t={name:"",parentId:"",isUserCanUse:"",isServiceUserCanUse:"",hasDtdServiceFee:"",dtdServiceFee:"",isPrepayDtd:"",employeeDtdServiceCommission:"",isShow:"",iconCode:"",description:"",id:""};for(var r in e)t[r]=e[r];t.serviceDescription=this.editor1.txt.html(),"add"===this.editProFormType?this.addNodeAPI(t):this.editNodeAPI(t)},cancelForm:function(){"first"===this.currentNodeType?(this.typeForm={name:"",sortIndex:null,isShow:""},this.editTypeForm=!1):"sub"===this.currentNodeType&&(this.proForm={name:"",parentId:"",isUserCanUse:"",isServiceUserCanUse:"",hasDtdServiceFee:"",dtdServiceFee:"",isPrepayDtd:"",employeeDtdServiceCommission:"",isShow:""},this.editProForm=!1)},addNewProjectType:function(){this.editTypeForm=!0,this.currentNodeType="first",this.editTypeFormType="add",this.typeForm={name:"",sortIndex:null,isShow:"",id:""}},addNewProject:function(){if(!this.currentNode.id||""==this.currentNode.parentId)return this.$Message.info("请先选择要添加到的项目分类"),!1;this.editProForm=!0,this.editProFormType="add",this.currentNodeType="sub",this.proForm={id:"",name:"",parentId:this.currentNode.id,isUserCanUse:"",isServiceUserCanUse:"",hasDtdServiceFee:"",dtdServiceFee:"",isPrepayDtd:"",employeeDtdServiceCommission:"",isShow:""}},delThis:function(){var e=this,t=this.currentNode.id;this.$store.commit("setDeleteModal",{model:!0,callback:function(){e.$http.delete("/yyht/v1/repair/category/delete?id="+t).then(function(t){0===t.data.code?(e.$Message.success("删除成功"),e.$store.commit("setDeleteModal",{model:!1}),e.getTreeLists(),e.initialForm(),e.$forceUpdate()):(e.$Message.info("删除失败："+t.data.msg),e.$store.commit("setDeleteModal",{model:!1}))})}})},getDetail:function(e){var t=this;this.$http.get("/yyht/v1/repair/category/info?id="+e).then(function(e){if(0===e.data.code){var r=e.data.data;0==t.currentNode.parentId?(t.currentNodeType="first",t.typeForm=a.a.cloneDeep(r)):(t.currentNodeType="sub",t.proForm=a.a.cloneDeep(r))}})},selectIcon:function(e){this.editProForm&&this.$set(this.proForm,"iconCode",e.iconCode)},changePort:function(e,t){this.currentNode=t,this.getDetail(t.id),this.editTypeForm=!1,this.editProForm=!1},getTreeLists:function(){var e=this;this.$http.get("/yyht/v1/repair/category/tree").then(function(t){if(0===t.data.code){var r=t.data.data;e.treeLists=e.formatDataTree(r),e.getTypeList()}})},formatDataTree:function(e){var t=this;return e.map(function(e){return e.title=e.name,e.expand=!1,e.children.length>0&&(e.children=t.formatDataTree(e.children)),e})},downExcelTpl:function(){this.$http.get("/repair/category/import/template",{responseType:"blob"}).then(function(e){l.a.downloadExcel(e)})},importExcel:function(){return"first"===this.currentNodeType||(this.$Message.info("请先选择要导入的项目服务分类结点"),!1)},uploadSuccess:function(e,t,r){0!==e.code?this.$Message.info(e.msg):(this.$Message.success("导入成功"),this.getTreeLists())},initialEditor:function(){this.editor1=new u.a("#serviceDescription");var e=this.editor1;e.customConfig.menus=["head","bold","fontSize","fontName","italic","underline","strikeThrough","foreColor","backColor","image","link","list","justify","undo","redo"],e.create(),this.editor1.$textElem.attr("contenteditable",!1)}},watch:{editProForm:function(e,t){e?this.editor1.$textElem.attr("contenteditable",!0):this.editor1.$textElem.attr("contenteditable",!1)}},mounted:function(){this.getTreeLists(),this.getTypeList(),this.initialEditor()}},h={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("Card",[r("div",{staticClass:"clearfix mb-15"},[r("div",{staticClass:"pull-left"},[r("Button",{attrs:{type:"primary",icon:"md-add"},on:{click:e.addNewProjectType}},[e._v("新建服务项目分类")]),e._v(" "),r("Button",{attrs:{type:"primary",icon:"md-add"},on:{click:e.addNewProject}},[e._v("新建服务项目")]),e._v(" "),r("Button",{attrs:{type:"primary"},on:{click:e.editNode}},[e._v("编辑")]),e._v(" "),r("Button",{attrs:{type:"error"},on:{click:e.delThis}},[e._v("删除")])],1),e._v(" "),r("div",{staticClass:"pull-right"},[r("Button",{on:{click:e.downExcelTpl}},[e._v("项目服务Excel导入模板下载")]),e._v(" "),r("Upload",{staticClass:"inline-button",attrs:{action:e.uploadUrl,"before-upload":e.importExcel,"show-upload-list":!1,"with-credentials":!0,"on-success":e.uploadSuccess,data:e.uploadData}},[r("Button",{attrs:{icon:"ios-cloud-upload-outline"}},[e._v("项目服务Excel导入")])],1)],1)]),e._v(" "),r("div",{staticClass:"content"},[r("Row",{attrs:{gutter:15}},[r("Col",{attrs:{span:"8"}},[r("Card",[r("p",{attrs:{slot:"title"},slot:"title"},[e._v("服务分类树")]),e._v(" "),r("Tree",{attrs:{data:e.treeLists},on:{"on-select-change":e.changePort}})],1)],1),e._v(" "),r("Col",{attrs:{span:"16"}},[r("Card",[r("p",{attrs:{slot:"title"},slot:"title"},[e._v(e._s("sub"!==e.currentNodeType?"服务项目分类":"服务项目"))]),e._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:"sub"!==e.currentNodeType,expression:"currentNodeType!=='sub'"}]},[r("Form",{ref:"typeForm",staticClass:"form-box",attrs:{model:e.typeForm,rules:e.typeRule,"label-width":150}},[r("FormItem",{staticClass:"must",attrs:{label:"名称",prop:"name"}},[r("Input",{attrs:{maxlength:10,disabled:!e.editTypeForm},model:{value:e.typeForm.name,callback:function(t){e.$set(e.typeForm,"name",t)},expression:"typeForm.name"}})],1),e._v(" "),r("FormItem",{staticClass:"must",attrs:{prop:"sortIndex",label:"用户端排序顺序"}},[r("InputNumber",{attrs:{disabled:!e.editTypeForm,min:1,precision:0},model:{value:e.typeForm.sortIndex,callback:function(t){e.$set(e.typeForm,"sortIndex",t)},expression:"typeForm.sortIndex"}})],1),e._v(" "),r("FormItem",{staticClass:"must",attrs:{prop:"isShow",label:"状态"}},[r("RadioGroup",{model:{value:e.typeForm.isShow,callback:function(t){e.$set(e.typeForm,"isShow",t)},expression:"typeForm.isShow"}},[r("Radio",{attrs:{disabled:!e.editTypeForm,label:"Y"}},[e._v("正常")]),e._v(" "),r("Radio",{attrs:{disabled:!e.editTypeForm,label:"N"}},[e._v("不显示")])],1)],1),e._v(" "),r("FormItem",{directives:[{name:"show",rawName:"v-show",value:e.editTypeForm,expression:"editTypeForm"}]},[r("Button",{attrs:{type:"primary"},on:{click:e.saveTypeForm}},[e._v("保存")]),e._v(" "),r("Button",{on:{click:e.cancelForm}},[e._v("取消")])],1)],1)],1),e._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:"sub"===e.currentNodeType,expression:"currentNodeType==='sub'"}]},[r("Form",{ref:"proForm",staticClass:"form-wrap",attrs:{model:e.proForm,"label-width":150}},[r("FormItem",{staticClass:"form-item",attrs:{label:"服务项目名称"}},[r("Input",{attrs:{maxlength:10,disabled:!e.editProForm},model:{value:e.proForm.name,callback:function(t){e.$set(e.proForm,"name",t)},expression:"proForm.name"}})],1),e._v(" "),r("FormItem",{staticClass:"form-item",attrs:{label:"所属服务类型"}},[r("Select",{attrs:{disabled:!e.editProForm},model:{value:e.proForm.parentId,callback:function(t){e.$set(e.proForm,"parentId",t)},expression:"proForm.parentId"}},e._l(e.typeLists,function(t){return r("Option",{key:t.id,attrs:{value:t.id}},[e._v(e._s(t.name))])}))],1),e._v(" "),r("FormItem",{staticClass:"form-item",attrs:{label:"用户可选"}},[r("Select",{attrs:{disabled:!e.editProForm},model:{value:e.proForm.isUserCanUse,callback:function(t){e.$set(e.proForm,"isUserCanUse",t)},expression:"proForm.isUserCanUse"}},[r("Option",{attrs:{value:"Y"}},[e._v("是")]),e._v(" "),r("Option",{attrs:{value:"N"}},[e._v("否")])],1)],1),e._v(" "),r("FormItem",{staticClass:"form-item",attrs:{label:"师傅可选"}},[r("Select",{attrs:{disabled:!e.editProForm},model:{value:e.proForm.isServiceUserCanUse,callback:function(t){e.$set(e.proForm,"isServiceUserCanUse",t)},expression:"proForm.isServiceUserCanUse"}},[r("Option",{attrs:{value:"Y"}},[e._v("是")]),e._v(" "),r("Option",{attrs:{value:"N"}},[e._v("否")])],1)],1),e._v(" "),r("FormItem",{staticClass:"form-item",attrs:{label:"是否收取上门费"}},[r("Select",{attrs:{disabled:!e.editProForm},model:{value:e.proForm.hasDtdServiceFee,callback:function(t){e.$set(e.proForm,"hasDtdServiceFee",t)},expression:"proForm.hasDtdServiceFee"}},[r("Option",{attrs:{value:"Y"}},[e._v("收取")]),e._v(" "),r("Option",{attrs:{value:"N"}},[e._v("不收取")])],1)],1),e._v(" "),"Y"===e.proForm.hasDtdServiceFee?[r("FormItem",{staticClass:"form-item",attrs:{label:"上门费金额"}},[e.editProForm?[r("InputNumber",{model:{value:e.proForm.dtdServiceFee,callback:function(t){e.$set(e.proForm,"dtdServiceFee",t)},expression:"proForm.dtdServiceFee"}})]:[r("Input",{attrs:{disabled:!e.editProForm},model:{value:e.proForm.dtdServiceFee,callback:function(t){e.$set(e.proForm,"dtdServiceFee",t)},expression:"proForm.dtdServiceFee"}})]],2),e._v(" "),r("FormItem",{staticClass:"form-item",attrs:{label:"是否需先支付上门费"}},[r("Select",{attrs:{disabled:!e.editProForm},model:{value:e.proForm.isPrepayDtd,callback:function(t){e.$set(e.proForm,"isPrepayDtd",t)},expression:"proForm.isPrepayDtd"}},[r("Option",{attrs:{value:"Y"}},[e._v("是")]),e._v(" "),r("Option",{attrs:{value:"N"}},[e._v("否")])],1)],1)]:e._e(),e._v(" "),r("FormItem",{staticClass:"form-item",attrs:{label:"是否推荐至首页"}},[r("Select",{attrs:{disabled:!e.editProForm},model:{value:e.proForm.isShow,callback:function(t){e.$set(e.proForm,"isShow",t)},expression:"proForm.isShow"}},[r("Option",{attrs:{value:"Y"}},[e._v("是")]),e._v(" "),r("Option",{attrs:{value:"N"}},[e._v("否")])],1)],1),e._v(" "),r("FormItem",{staticClass:"form-item",attrs:{label:"员工结算标准"}},[r("Input",{attrs:{disabled:!e.editProForm},model:{value:e.proForm.employeeDtdServiceCommission,callback:function(t){e.$set(e.proForm,"employeeDtdServiceCommission",t)},expression:"proForm.employeeDtdServiceCommission"}})],1),e._v(" "),r("FormItem",{staticClass:"form-item",attrs:{label:"服务备注"}},[r("Input",{attrs:{disabled:!e.editProForm,type:"textarea"},model:{value:e.proForm.description,callback:function(t){e.$set(e.proForm,"description",t)},expression:"proForm.description"}})],1),e._v(" "),r("FormItem",{staticClass:"form-item editor-item",attrs:{label:"服务说明"}},[r("div",{attrs:{id:"serviceDescription"}})]),e._v(" "),r("FormItem",{attrs:{label:"选择图标样式"}},[r("ul",{staticClass:"icon-lists"},e._l(e.iconLists,function(t){return r("li",{key:t.iconCode,class:t.iconCode==e.proForm.iconCode?"icon-wrap active":"icon-wrap",on:{click:function(r){e.selectIcon(t)}}},[r("img",{attrs:{src:t.iconUrl,alt:t.iconCode}}),e._v(" "),r("span",{staticClass:"icon-text"},[e._v(e._s(t.name))])])}))]),e._v(" "),r("FormItem",{directives:[{name:"show",rawName:"v-show",value:e.editProForm,expression:"editProForm"}]},[r("Button",{attrs:{type:"primary"},on:{click:e.saveProForm}},[e._v("保存")]),e._v(" "),r("Button",{on:{click:e.cancelForm}},[e._v("取消")])],1)],2)],1)])],1)],1)],1)])},staticRenderFns:[]};var F=r("VU/8")(v,h,!1,function(e){r("2btl")},"data-v-4d125184",null);t.default=F.exports},qAFU:function(e,t){}});